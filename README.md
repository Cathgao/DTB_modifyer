# 简介

一个方便修改高通晓龙设备（安卓手机）内核DTB中GPU电压的小工具。此工具已在晓龙870上验证，更旧或更新的SOC请自行验证，理论上若DTB文件结构一致即可通用。

100MHz<GPU频率≥1GHz、电压值≥0xFFFF**切勿使用**，因为位数增加或减少造成了数值地址不同，直接修改会写入错误的电压值

**修改电压有一定的危险性，非专业人士或对此不熟悉请谨慎使用。因使用此工具产生的一切后果自行承担**

# 如何使用

**一切的前提：你的手机已经解除BL锁且拥有随时可用的第三方TWRP**

## 1. 提取当前内核的DTB文件

**注意：任何内核的dtb文件都不可混用！必须使用内核中提取的dtb文件！**

DTB文件可在第三方内核刷机包中提取，举个例子：

![image](https://github.com/Cathgao/DTB_modifyer/assets/21031564/2fad02d6-b375-4e21-8d40-fce5319dab34)

此时需要将dtb从压缩包中解压出来（无需解压整个压缩包）

此外，原厂的刷机包中亦可提取出原厂内核的dtb文件，但修改后的dtb能否通过原厂的BL验证，未做任何测试。有关如何解包原厂ROM，请自行查阅相关资料，此处不作说明。

## 2. 使用此工具打开dtb文件修改电压值

![image](https://github.com/Cathgao/DTB_modifyer/assets/21031564/b02e52b2-bbe3-4859-8ab4-3e6a8446aa9b)


可输入框的左列为电压值的16进制表示，右边为10进制表示，修改任意其中一个表示方式都可自动计算出另一个。

由于DTB文件可能描述多个SOC，因此频率表会有重复的情况。建议是重复的频率也进行修改，避免修改的电压值不生效。

修改完毕后，点击写入，工具会自动计算出修改值与原来的差值，方便对比。修改后的文件以 `dtb_new` 文件名保存至原文件同目录下，原文件不作修改

![image](https://github.com/Cathgao/DTB_modifyer/assets/21031564/ebb01cbd-5d89-4073-acc5-b5d133032eee)

## 3. 对比检查新旧dtb文件（建议）

使用Beyond Compare（或类似工具）对比新旧文件，确保只修改了电压部分

![image](https://github.com/Cathgao/DTB_modifyer/assets/21031564/4bca9555-c609-4ecb-a24a-531cec459cfa)


## 4. 将修改后的dtb文件替换到刷机包中

备份好刷机包或原dtb文件，将`dtb_new` 文件名改为原文件名，覆盖到刷机包中：


![image](https://github.com/Cathgao/DTB_modifyer/assets/21031564/2a50c952-7416-49a4-b616-289424730aff)

## 5. 使用recovery刷入刷机包



# Q&A

## 1. 为什么要修改DTB文件？

内核中DTB文件存在GPU的频率表以及相应电压，通过修改DTB对应频率的电压值可控制GPU达到此频率时的电压。降低电压可以减少GPU热量及延长续航时间，但过低的电压会造成GPU不稳定乃至应用渲染错误、崩溃。合适的电压值需要自己多次修改、测试

## 2. 为什么只修改电压，不修改GPU的频率？

DTB的频率必须对应内核中可用的频率，否则会启动失败。若需要超频，需要自行刷入超频内核

## 3. 为什么不反编译DTB为DTS进行修改？

虽然反编译DTB为DTS后更容易被人类理解和修改，但实测经过dtb→dts→dtb的过程后，获得的dtb与原来的差异太大。本着最小修改的原则，我们应该只修改我们需要的地方，所以直接在dtb上修改二进制是比较保险的方式

## 4. 如何验证电压修改是否生效？

目前未知如何在系统中实时监测GPU的电压，但有个十分简单而暴力的方法验证，那就是大幅减少某个频率的电压（增大电压可能会损坏硬件），在系统中将GPU调至此运行频率，若出现不稳定的情况，说明电压修改已经生效。

## 5. CPU电压可以改吗？

目前未知CPU电压在哪控制，所以不能。若热心人士懂得如何修改，欢迎issue讨论或PR
